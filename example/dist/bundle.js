(()=>{var e={466:function(e){var t;e.exports=((t=function(){function e(e){return a.appendChild(e.dom),e}function i(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";s=e}var s=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",(function(e){e.preventDefault(),i(++s%a.children.length)}),!1);var r=(performance||Date).now(),o=r,n=0,h=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:a,addPanel:e,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){n++;var e=(performance||Date).now();if(l.update(e-r,200),e>o+1e3&&(h.update(1e3*n/(e-o),100),o=e,n=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:a,setMode:i}}).Panel=function(e,t,i){var s=1/0,a=0,r=Math.round,o=r(window.devicePixelRatio||1),n=80*o,h=48*o,l=3*o,c=2*o,d=3*o,m=15*o,f=74*o,p=30*o,g=document.createElement("canvas");g.width=n,g.height=h,g.style.cssText="width:80px;height:48px";var w=g.getContext("2d");return w.font="bold "+9*o+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=i,w.fillRect(0,0,n,h),w.fillStyle=t,w.fillText(e,l,c),w.fillRect(d,m,f,p),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(d,m,f,p),{dom:g,update:function(h,u){s=Math.min(s,h),a=Math.max(a,h),w.fillStyle=i,w.globalAlpha=1,w.fillRect(0,0,n,m),w.fillStyle=t,w.fillText(r(h)+" "+e+" ("+r(s)+"-"+r(a)+")",l,c),w.drawImage(g,d+o,m,f-o,p,d,m,f-o,p),w.fillRect(d+f-o,m,o,p),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(d+f-o,m,o,r((1-h/u)*p))}}},t)}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,i),r.exports}i.m=e,i.u=e=>e+".bundle.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&!e;)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),i.b=document.baseURI||self.location.href,(()=>{"use strict";class e{constructor(e,t={}){this.fileInfo=[],this.resolve=[],this.defaultOptions={useWorker:!0},this.buffer=e,this.options={...this.defaultOptions,...t};let i=0;for(;i<this.buffer.byteLength-512;){const e=this.readFileName(i);if(0==e.length)break;const t=this.readFileSize(i);this.fileInfo.push({name:e,size:t,header_offset:i}),i+=512+512*Math.trunc(t/512),t%512&&(i+=512)}}readFileName(e){const t=new Uint8Array(this.buffer,e,100),i=t.indexOf(0);return(new TextDecoder).decode(t.slice(0,i))}readFileSize(e){const t=new Uint8Array(this.buffer,e+124,12);let i="";for(let e=0;e<11;e++)i+=String.fromCharCode(t[e]);return parseInt(i,8)}getInfo(e){return this.fileInfo.find((t=>t.name==e))}getBlob(e,t=""){const i=this.getInfo(e);if(i){const e=new Uint8Array(this.buffer,i.header_offset+512,i.size);return new Blob([e],{type:t})}}getImage(e,t){return this.options.useWorker?(this.worker||(this.worker=this.createWorker()),new Promise(((i,s)=>{const a=this.getInfo(e);a&&!this.resolve[t]?(this.resolve[t]=i,this.worker.postMessage({cmd:"load",offset:a.header_offset+512,size:a.size,index:t})):s()}))):new Promise(((t,i)=>{const s=this.getBlob(e,"image");void 0!==s?createImageBitmap(s).then((e=>{t(e)})).catch((()=>{i()})):i()}))}createWorker(){const e=new Worker(new URL(i.p+i.u(144),i.b));return e.addEventListener("message",(e=>{const t=this.resolve[e.data.index];this.resolve[e.data.index]=void 0,t?t(e.data.imageBitmap):e.data.imageBitmap.close()})),e.postMessage({cmd:"init",buffer:this.buffer},[this.buffer]),e}}class t{constructor(e,t){this.priority=0,this.tarImageAvailable=!1,this.loading=!1,this.loadingLowRes=!1,this.index=t,this.context=e}async getImage(){return new Promise((async(e,t)=>{void 0!==this.highRes?e(this.highRes):void 0!==this.lowRes?e(this.lowRes):this.fetchLowRes().then((t=>e(t))).catch((()=>t()))}))}loadImage(e,t){return new Promise(((i,s)=>{e.onload=()=>i(e),e.onerror=e=>s(e),e.src=t}))}get lowRes(){return void 0===this._lowRes||this.loadingLowRes?void 0:this._lowRes}async fetchLowRes(){return new Promise(((e,t)=>{void 0!==this.lowRes?e(this.lowRes):this.tarImageAvailable&&!this.loadingLowRes?(this.loadingLowRes=!0,this.context.tarball.getImage(this.tarImageURL,this.index).then((t=>{this._lowRes=t,this.loadingLowRes=!1,e(t)})).catch((()=>{this.loadingLowRes=!1,t()}))):t()}))}releaseHighRes(){this.highRes&&(this.highRes.close(),this.highRes=void 0)}releaseLowRes(){this.lowRes&&(this.lowRes instanceof ImageBitmap&&this.lowRes.close(),this._lowRes=void 0,this.loadingLowRes=!1)}get tarImageURL(){return this.context.options.tarImageURLCallback?this.context.options.tarImageURLCallback(this.index):void 0}get imageURL(){return this.context.options.imageURLCallback?new URL(this.context.options.imageURLCallback(this.index),window.location.href).href:void 0}}class s{constructor(){this.index=-1e10;const e=new Worker(new URL(i.p+i.u(79),i.b));e.addEventListener("message",(e=>{this.resolve&&e.data.index===this.index?this.resolve(e.data.imageBitmap):e.data.imageBitmap.close()})),this.worker=e}load(e,t){return this.index=e,new Promise(((i,s)=>{this.resolve=i,this.worker.postMessage({cmd:"load",url:t,index:e})}))}abort(){this.index=-1e10,this.resolve=void 0}}class a{constructor(i,s){if(this.width=0,this.height=0,this.frame=0,this.tickFuncs=[],this.frames=[],this.startTime=-1,this.animationRequestId=0,this.clearCanvas=!0,this.maxLoading=6,this.workerPool=[],this.speed=0,this.prevFrame=0,this.direction=1,this.lastFrameDrawn=-1,this.options={...a.defaultOptions,...s},this.options.frames<=0)throw new Error("FastImageSequence: frames must be greater than 0");this.container=i,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.fillStyle=this.options.fillStyle,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.resizeObserver=new ResizeObserver((()=>{this.clearCanvas=!0})),this.resizeObserver.observe(i);for(let e=0;e<this.options.frames;e++)this.frames.push(new t(this,e));this.ready=new Promise((async(t,i)=>{if(void 0!==this.options.tarURL){const t=await fetch(this.options.tarURL),i=await t.blob(),s=await i.arrayBuffer();this.tarball=new e(s,{useWorker:this.options.useWorkerForTar}),this.frames.forEach((e=>e.tarImageAvailable=void 0!==e.tarImageURL&&void 0!==this.tarball?.getInfo(e.tarImageURL))),this.options.preloadAllTarImages&&await Promise.all(this.frames.map((e=>e.fetchLowRes())))}t()})),this.drawingLoop(-1)}tick(e){this.tickFuncs.push(e)}getWorker(){return 0===this.workerPool.length&&this.workerPool.push(new s),this.workerPool.shift()}releaseWorker(e){e.abort(),this.workerPool.push(e)}get index(){return this.wrapIndex(this.frame)}wrapIndex(e){const t=0|e;return this.wrapFrame(t)}wrapFrame(e){return this.options.wrap?(e%this.options.frames+this.options.frames)%this.options.frames:Math.max(Math.min(e,this.options.frames-1),0)}async drawingLoop(e=0){e/=1e3;const t=this.startTime<0?1/60:Math.min(e-this.startTime,1/30);this.startTime=e>0?e:-1,this.frame-this.prevFrame<0&&(this.direction=-1),this.frame-this.prevFrame>0&&(this.direction=1),this.frame+=this.speed*t,this.frame=this.wrapFrame(this.frame);let i=this.index;this.frames[i].getImage().then((e=>{this.drawFrame(e,i)})).catch((()=>{})),this.load(t),this.prevFrame=this.frame,this.tickFuncs.forEach((e=>e(t))),this.animationRequestId=window.requestAnimationFrame((e=>this.drawingLoop(e)))}drawFrame(e,t){if(Math.abs(this.lastFrameDrawn-this.index)<Math.abs(t-this.index))return;this.lastFrameDrawn=t;const i=this.container.offsetWidth/this.container.offsetHeight,s=e.width/e.height;if(this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height),"contain"===this.options.size){const e=i>s?this.height*i:this.width,t=i>s?this.height:this.width/i;this.canvas.width===e&&this.canvas.height===this.height||(this.canvas.width=e,this.canvas.height=t)}else{const e=i>s?this.width:this.height*i,t=i>s?this.width/i:this.height;this.canvas.width===e&&this.canvas.height===this.height||(this.canvas.width=e,this.canvas.height=t)}const a=(this.canvas.width-this.width)/2,r=(this.canvas.height-this.height)/2;(this.clearCanvas||this.options.clearCanvas)&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.clearCanvas=!1),this.context.drawImage(e,0,0,e.width,e.height,a,r,this.width,this.height)}load(e){this.index;const t=this.index;this.frames.forEach((e=>{e.priority=Math.abs(e.index-t),this.options.wrap&&(e.priority=Math.min(e.priority,this.options.frames-e.priority))}));let i=this.frames.filter((e=>e.loading)).length;const s=this.maxLoading;this.frames.filter((e=>void 0!==e.highRes&&!e.loading&&e.priority>this.spread)).forEach((e=>{e.releaseHighRes(),this.options.preloadAllTarImages||e.releaseLowRes()}));const a=this.frames.filter((e=>void 0===e.highRes&&!e.loading&&e.priority<=this.spread)).sort(((e,t)=>e.priority-t.priority));for(;i<s&&a.length>0;){const e=a.shift(),t=e.index;if(void 0!==e.imageURL){e.loading=!0;const i=this.getWorker();i.load(t,e.imageURL).then((t=>{e.releaseHighRes(),e.highRes=t,e.loading=!1,this.releaseWorker(i)}))}i++}}get spread(){return this.options.wrap?Math.floor(this.options.numberOfCachedImages/2):this.options.numberOfCachedImages}play(e=30){this.speed=e}stop(){this.speed=0}get isPlaying(){return 0!==this.speed}get isPaused(){return!this.isPlaying}get progress(){return this.index/(this.options.frames-1)}set progress(e){this.frame=(this.options.frames-1)*e}getFrameImage(e){return this.frames[this.wrapIndex(e)].getImage()}destruct(){cancelAnimationFrame(this.animationRequestId),this.resizeObserver.disconnect(),this.container.removeChild(this.canvas),this.canvas.replaceWith(this.canvas.cloneNode(!0))}}a.defaultOptions={frames:1,imageURLCallback:void 0,tarURL:void 0,tarImageURLCallback:void 0,wrap:!1,fillStyle:"#00000000",size:"cover",preloadAllTarImages:!1,clearCanvas:!1,useWorkerForTar:!0,numberOfCachedImages:32};const r=a,o=new(i(466));o.showPanel(0),document.body.appendChild(o.dom);const n=document.getElementsByClassName("container")[0],h=document.getElementById("prev-button"),l=document.getElementById("next-button"),c=document.getElementById("slider-input");!async function(){const e=new r(n,{frames:425,wrap:!1,imageURLCallback:e=>`./static/getty_persepolis_WebGL_intro_comp_v010.1${(""+(e+1)).padStart(3,"0")}.avif`,tarURL:"./static/lowres.tar",tarImageURLCallback:e=>`getty_persepolis_WebGL_intro_comp_v010.1${(""+(e+1)).padStart(3,"0")}.avif`});await e.ready,document.getElementsByClassName("loading")[0].remove(),e.progress=0,e.tick((t=>{o.begin(),e.isPlaying&&(c.value=e.progress),o.end()})),h.addEventListener("click",(()=>{e.play(-30)})),l.addEventListener("click",(()=>{e.play(30)})),c.addEventListener("mousedown",(t=>{e.stop()})),c.addEventListener("input",(()=>{e.isPaused&&(e.progress=c.value)})),e.play(30),console.log(e)}()})()})();